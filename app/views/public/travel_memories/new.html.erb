<div class="container">
  <%= render 'public/travel_memories/errors', obj: @travel_memory %>
  <div class="row">
    <div class="col-md-6" style="margin-top: 50px;">
      <h1>新規投稿</h1>
      <%= form_with model: @travel_memory, url: travel_memories_path, method: :post do |f| %>
        <h5>画像</h5>
        <%= f.file_field :image, accept: "image/*" %>

        <h5>場所</h5>
        <%= f.text_field :place %>

        <h5>紹介文</h5>
        <%= f.text_area :introduction %>

        <%= f.hidden_field :customer_id, value: current_customer.id %>
        <p>
          <%= f.submit '投稿する', class: "btn btn-md btn-success" %>
        </p>

      <% end %>
      <p>
        <%= link_to '一覧に戻る', travel_memories_path, class: "btn btn-sm btn-primary" %>
      </p>
    </div>
    <div class="col-md-6" style="margin-top: 50px;">
      <div id="header">Google Maps - 場所検索</div>
      <input type="text" id="address">
      <input type="text" id="mapKeyword" name="keyword"><button id="search">検索</button>
      <button id="clear">クリア</button>
      <style>
        #map {
          height: 400px;
          width: auto;
        }
      </style>
      <div id="map">
        <script>
          var map;
          var marker;
          var infoWindow;

          function initMap() {
            // マップ初期表示の位置設定
            var target = document.getElementById('map');
            var empire = {lat: 34.5801650, lng: 135.4623190};

            // マップ表示
            map = new google.maps.Map(target, {
              center: empire;
              zoom: 8
            });
          }

          document.getElementById('search').addEventListener('click', function() {
            var place = document.getElementById('mapKeyword').value;
            var geocoder = new google.maps.Geocoder();

            geocoder.geocode({
              address: place
            }, function(results, status) {
              if (status == google.maps.GeocoderStatus.OK) {
                var bounds = new google.maps.LatLngBounds();

                for (var i in results) {
                  // 緯度経度を取得
                  var latlng = results[0].geomentry.location;
                  // 住所を取得
                  var address = results[0].formatted_address;
                  // 検索結果ちが含まれるように拡大
                  bounds.extend(latlng);
                  // マーカーのセット
                  setMarker(latlng);
                  // マーカーにクリックイベントを追加
                  markerEvent();
                }
              }
              map.fitBounds(bounds);
              document.getElementById('address').value = latlng;
            } else if (status == google.maps.GeocoderStatus.ZERO_RESULTS) {
              alert("見つかりません");
            } else {
              console.log(place);
              console.log(geocoder);
              console.log(results);
              console.log(status);
              alert("エラー発生")
            }
          });
        });

        // 検索クリアボタン押下時
        document.getElementById('clear').addEventListener('click', function() {
          deleteMarkers();
        });

        // マーカーのセットを実施する
        function setMarker(setplace) {
          deleteMarkers();

          var iconUrl = 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png';
          marker = new google.maps.Marker({
            position: setplace,
            mamp: map,
            icon: iconUrl
          });
        }
        // マーカーを削除する
        function deleteMarkers() {
          if(marker != null){
            marker.setMap(null);
          }
          marker = null;
        }

        // クリックイベント
        function markerEvent() {
          marker.addListener('click', function() {
            infoWindow.open(map, marker);
          });
        }
        </script>
      </div>
    </div>
  </div>
</div>
